# Symi Proxy

Home Assistant OS的代理管理插件，支持订阅地址和节点选择。

## 版本更新

当前版本：1.2.0

## 最新更新内容

### 1.2.0 版本 (2025年5月24日) - 重大修复版本 🔥
- **修复核心问题**: 解决"能查看节点信息但实际没有连上网络"的问题
  - 添加了缺失的代理服务器实现
  - 实现真正的网络代理功能
  - 支持HTTP CONNECT代理协议
- **新增诊断工具**:
  - Web界面测试连接功能
  - 全面的诊断脚本 (`diagnose.py`)
  - 连接测试脚本 (`test_proxy.py`)
- **增强稳定性**:
  - 多线程连接处理
  - 自动故障切换
  - 更好的错误处理和日志记录

### 1.1.7 版本 (2025年5月9日)
- 增强Home Assistant兼容性
  - 自动配置Home Assistant使用代理
  - 测试Home Assistant相关网站连接
  - 提供详细的连接测试结果
- 优化连接测试方法
  - 测试更多与Home Assistant相关的网站
  - 提供更详细的测试结果报告
  - 增强测试准确性

### 1.1.6 版本 (2025年5月9日)
- 强制优先使用自定义节点，不再自动切换到订阅节点
- 确保用户手动配置的节点始终被使用
- 修复订阅更新后节点自动切换的问题
- 优化节点选择逻辑，提高用户体验

### 1.1.5 版本 (2025年5月9日)
- 修复数据传输问题，移除XOR编码
- 优化连接测试方法，提高测试准确性
- 改进代理处理逻辑，提高连接成功率

### 1.1.4 版本 (2025年5月9日)
- 增加对Shadowsocks订阅格式的支持
- 增加对Clash订阅格式的支持
- 优化订阅解析逻辑，自动检测订阅类型
- 增强节点解析功能，支持更多格式

### 1.1.3 版本 (2025年5月9日)
- 修复节点配置加载问题，确保正确使用配置的加密方式和混淆方式
- 增加节点配置调试信息，方便排查问题
- 优化配置文件处理，提高配置一致性

### 1.1.2 版本 (2025年5月8日)
- 改进连接测试方法，提高测试准确性
- 优化代理连接逻辑，提高连接成功率
- 简化测试流程，只测试国际网站连接
- 增加更详细的错误提示和故障排除信息

### 1.1.1 版本 (2025年5月8日)
- 更新节点配置信息，修正服务器端口和加密方式
- 优化配置示例，提供完整的JSON配置选项
- 增加可选字段说明，方便用户进行高级配置

### 1.1.0 版本 (2025年5月8日) - 正式版
- 增强代理功能，添加HTTP代理支持
- 增加连接验证功能，自动测试网络连接
- 增强日志输出，提供详细的连接和数据传输信息
- 修复订阅解析问题，提高稳定性
- 优化自定义节点配置，提供更直观的配置方式

### 1.0.11 版本 (2025年5月8日)
- 优化自定义节点配置，提供可直接复制粘贴的配置示例
- 简化配置过程，提高用户体验
- 更新示例配置，使用更直观的格式

### 1.0.10 版本 (2025年5月8日)
- 增强订阅解析功能，支持更多格式
- 修复了SSR链接解析问题
- 优化了自定义节点配置
- 更新了示例配置

### 1.0.9 版本 (2025年5月8日)
- 使用Alpine 3.17基础镜像，提高兼容性
- 分步执行依赖安装，避免安装失败
- 简化启动脚本，增强错误处理
- 添加默认配置文件创建功能

### 1.0.8 版本 (2025年5月8日)
- 修复了Alpine Linux包管理器安装问题
- 简化了依赖安装过程，提高了兼容性
- 增强了启动脚本的错误处理能力

### 1.0.7 版本 (2025年5月8日)
- 修复了订阅解析问题，增强了Base64解码功能
- 改进了iptables规则设置，提高了稳定性
- 优化了健康检查机制，避免端口冲突
- 增强了错误处理和日志记录
- 更新了文档，添加了更详细的使用说明

### 1.0.6 版本
- 修复了Alpine Linux包管理器安装命令的问题
- 修正了Alpine仓库URL格式，移除了多余的引号
- 统一了所有配置文件中的版本号

## 安装说明

1. 在Home Assistant中添加此仓库：https://github.com/symi-daguo/symi-proxy
2. 安装Symi Proxy插件
3. 配置您的订阅URL或自定义节点
4. 启动插件

## 详细配置说明

### 快速配置
插件提供了简化的配置界面，只需填写以下信息即可快速启动：

1. **订阅URL**：填入您的订阅地址，例如 `https://rss.rss-node.com/link/rjzfONPggKdGMI1B?mu`
2. **使用自定义节点**：如果您想使用自定义节点而不是订阅，请开启此选项
3. **自定义节点信息**：如果开启了自定义节点，请填写节点详细信息

### 订阅URL
在配置页面中填入您的订阅URL，插件会自动解析并获取节点信息。支持的订阅格式包括：

- **SSR订阅**：
  - Base64编码的SSR链接列表
  - 标准的SSR订阅格式

- **Shadowsocks订阅**：
  - Base64编码的SS链接列表
  - 支持新旧两种SS URL格式

- **Clash订阅**：
  - YAML格式的Clash配置
  - JSON格式的Clash配置
  - 自动提取SS和SSR节点

- **其他格式**：
  - JSON格式的节点配置
  - 纯文本格式（每行一个节点）

### 自定义节点
如果您不使用订阅，可以开启"使用自定义节点"选项，然后填写节点信息。

#### 快速配置方法
您可以直接复制以下配置信息，粘贴到配置界面的"自定义节点"文本框中：

```json
{
  "server": "d3.alibabamysql.com",
  "server_port": 7001,
  "password": "di15PV",
  "method": "chacha20-ietf",
  "protocol": "auth_aes128_md5",
  "protocol_param": "72291:gMe1NM",
  "obfs": "tls1.2_ticket_auth",
  "obfs_param": "90f3b72291.www.gov.hk"
}
```

或者您也可以直接复制以下完整配置（包含更多参数）：

```json
{
  "server": "d3.alibabamysql.com",
  "local_address": "127.0.0.1",
  "local_port": 1080,
  "timeout": 300,
  "workers": 1,
  "server_port": 7001,
  "password": "di15PV",
  "method": "chacha20-ietf",
  "obfs": "tls1.2_ticket_auth",
  "obfs_param": "90f3b72291.www.gov.hk",
  "protocol": "auth_aes128_md5",
  "protocol_param": "72291:gMe1NM"
}
```

#### 手动配置字段说明
如果您需要手动配置，以下是各字段的说明：
- `server`: 服务器地址，例如 `d3.alibabamysql.com`
- `server_port`: 服务器端口，例如 `7001`
- `password`: 密码，例如 `di15PV`
- `method`: 加密方式，例如 `chacha20-ietf`
- `protocol`: 协议，例如 `auth_aes128_md5`
- `protocol_param`: 协议参数，例如 `72291:gMe1NM`
- `obfs`: 混淆方式，例如 `tls1.2_ticket_auth`
- `obfs_param`: 混淆参数，例如 `90f3b72291.www.gov.hk`

可选字段：
- `local_address`: 本地监听地址，默认 `127.0.0.1`
- `local_port`: 本地监听端口，默认 `1080`
- `timeout`: 超时时间（秒），默认 `300`
- `workers`: 工作线程数，默认 `1`

### 端口设置
- `local_port`: 本地代理端口，默认7088
- `web_port`: Web管理界面端口，默认8123

## 使用说明

1. 安装并启动插件后，访问 `http://your-homeassistant:8123` 进入Web管理界面
2. 在界面中可以查看所有节点状态、选择节点、更新订阅
3. 选择节点后，插件会自动启动代理服务
4. 在Home Assistant中配置网络使用此代理，即可正常访问网络

## 功能特点
- 支持多种订阅格式
  - SSR订阅
  - Shadowsocks订阅
  - Clash订阅
  - JSON格式配置
- 支持自定义节点配置
  - 支持直接复制粘贴JSON配置
  - 支持手动填写各项参数
- 提供Web界面进行管理
- 自动更新订阅
- 自动检测节点可用性
- 自动选择最佳节点

## 问题排查

如果遇到"安装加载项失败"错误，请确认：
1. 您的Home Assistant可以访问互联网
2. Alpine Linux仓库可以正常访问

如果插件安装成功但无法连接网络：
1. 检查订阅URL是否有效
2. 检查节点是否可用（在Web界面中可以查看节点状态）
3. 检查Home Assistant网络配置是否正确使用了代理

## 联系方式

如有问题，请在GitHub仓库提交Issue。
